<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Backbone Validate Demo</title>

    <script src="../lib/jquery.min.js"></script>
    <script src="../lib/underscore.min.js"></script>
    <script src="../lib/backbone.min.js"></script>
    <script src="../dist/backbone.validate.js"></script>

    <style type="text/css">
      ul { list-style: none; }
    </style>
  </head>
  <body>
    <ul>
      <li>
        <input id="name" type="text"/>
      </li>
      <li>
        <input id="email" type="text"/>
      </li>
      <li>
        <input id="age" type="text"/>
      </li>
    </ul>

    <ul id="phoneNumbers">
      <li>
        <input name="phoneNumber" type="text"/>
        <input name="type" type="text"/>
      </li>
    </ul>
    <button id="addPhoneNumber">Add Phone Number</button>

    <button id="validate">Validate</button>
    
    <script>
      $(function() {
        var ExampleModel = Backbone.Model.extend({
          validations: {
            name: {
              required: true
            },
            email: {
              email: true
            },
            age: {
              range: [0, 200]
            },
            phoneNumbers: {
              phoneNumber: {
                required: true,
                custom: function(v) {
                  if(v === '') return 'BOOM!';
                }
              },
              type: {
                required: true
              }
            }
          }
        });

        var ExampleView = Backbone.View.extend({
          el: 'body',
          events: {
            'click #addPhoneNumber': 'addPhoneNumber',
            'click #validate': 'submit'
          },
          initialize: function() {
            this.model = new ExampleModel();
            this.model.on('error', $.proxy(this.error, this));
            this.$name = this.$('#name');
            this.$email = this.$('#email');
            this.$age = this.$('#age');
            this.$phoneNumbers = this.$('#phoneNumbers');
          },
          addPhoneNumber: function(e) {
            e.preventDefault();

            this.$phoneNumbers.append('<li><input type="text"/></li>');
          },
          submit: function(e) {
            e.preventDefault();
            this.$('.error').remove();

            /*pn = _.map(this.$phoneNumbers.find('input'), function(p) {
              $p = $(p);
              return {
                phoneNumber: 
              };
            });
            console.log('pn', pn);*/

            this.model.set({
              name: this.$name.val() || '',
              email: this.$email.val() || '',
              age: this.$age.val() || '',
              phoneNumbers: {
                phoneNumber: this.$phoneNumbers.find('input[name=phoneNumber]').val(),
                type: this.$phoneNumbers.find('input[name=type]').val()
              }
            });
          },
          error: function(model, obj) {
            console.log('error!', model, obj);
            this.renderErrors(obj);
          }
        });

        new ExampleView();
      });
    </script>
  </body>
</html>